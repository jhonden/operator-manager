# 算子基本信息扩展 - 需求设计文档

**文档版本**: v1.0
**创建日期**: 2026-02-20
**状态**: 已批准

---

## 1. 需求概述

### 1.1 需求背景
当前算子基本信息字段较为简单，仅支持 Operator Name、Description、Programming Language、Version 这几个字段。为了更好地标识和管理算子，需要对算子基本信息进行扩展，增加更多业务相关的字段。

### 1.2 需求目标
扩展算子实体，增加以下字段以支持更完善的算子管理：
- 算子唯一编码（全局唯一）
- 数据对象编码
- 数据格式（多选）
- 生成方式

### 1.3 原始需求记录
用户提供的原始需求描述：

> 当前的算子的基本信息只支持 Operator Name, Description，Programming Language，Version这几个字段，我们需要它添加几个字段
> * Operator Code : 算子唯一编码，一个算子只有一个编码，字符串格式，长度64，只允许字母，数字和下划线组成，数字不能开头，必须字段
> * Object Code : 数据对象编码，算子还原后输出的数据建模的数据对象的编码，字符串格式，校验格式同Operator Code
> * Data Format : 下拉复选没举止，可选集为：1-静态MML, 10-动态MML, 12-话统，该字段主要用来表达该算子使用来解析处理哪种原数据的
> * Generator: 可选字段，表征算子是动态生成还是静态内置，下拉单选：dynamic-动态， static-静态

需求讨论确认：
- Object Code 是必填
- Data Format 是多选
- 存储代码值如 "1,10"、"10,12"、"12"
- Operator Code 需要全局唯一即可
- 不用考虑现有算子数据，还没有人用系统

---

## 2. 功能需求

### 2.1 功能描述
在 Operator 实体中新增 4 个字段，包括数据库表结构、后端实体、DTO、API、前端表单和展示页面的完整支持。

### 2.2 用户故事
作为算子开发者，我希望在创建算子时能够填写算子唯一编码、数据对象编码、数据格式和生成方式，以便更好地分类和管理算子资源。

作为系统用户，我希望能够通过算子唯一编码快速定位和引用特定的算子。

### 2.3 功能清单

| 功能点 | 描述 | 优先级 |
|--------|------|--------|
| 数据库表结构更新 | 在 operators 表中新增 4 个字段 | P0 |
| 后端实体更新 | 更新 Operator 实体类 | P0 |
| 后端 DTO 更新 | 更新 OperatorDto 相关 DTO | P0 |
| 后端 API 更新 | 更新 Controller 和 Service | P0 |
| 参数验证 | Operator Code 和 Object Code 格式校验 | P0 |
| 唯一性约束 | Operator Code 全局唯一性校验 | P0 |
| 前端表单更新 | 算子创建/编辑表单新增字段 | P0 |
| 前端展示更新 | 算子列表/详情页面展示新字段 | P0 |
| 数据格式枚举管理 | Data Format 选项常量定义 | P0 |
| 生成方式枚举管理 | Generator 枚举定义 | P0 |

---

## 3. 非功能需求

### 3.1 性能要求
- 新增字段的查询性能需满足现有系统响应时间要求
- Operator Code 唯一性校验不影响算子创建的性能

### 3.2 安全要求
- 新增字段需要进行参数校验，防止非法输入
- Operator Code 格式校验需防止 SQL 注入和 XSS 攻击

### 3.3 可用性要求
- 新增字段在界面上需要有清晰的提示和帮助信息
- Data Format 多选操作需支持便捷的选择和取消

---

## 4. 技术方案

### 4.1 整体设计
遵循现有 Clean Architecture 架构，按层次更新代码：
1. **Domain 层** (operator-core): 更新 Operator 实体
2. **API 层** (operator-api): 更新 DTO 和 Controller
3. **Service 层** (operator-service): 更新业务逻辑（增加唯一性校验）
4. **Common 层** (operator-common): 更新通用常量和验证器

### 4.2 数据库设计

#### operators 表新增字段

```sql
ALTER TABLE public.operators
ADD COLUMN operator_code VARCHAR(64) NOT NULL,
ADD COLUMN object_code VARCHAR(64) NOT NULL,
ADD COLUMN data_format VARCHAR(20),
ADD COLUMN generator VARCHAR(20);

-- 添加唯一索引
CREATE UNIQUE INDEX idx_operator_code ON public.operators (operator_code);

-- 添加普通索引提升查询性能
CREATE INDEX idx_object_code ON public.operators (object_code);
CREATE INDEX idx_data_format ON public.operators (data_format);
CREATE INDEX idx_generator ON public.operators (generator);
```

**字段说明：**

| 字段名 | 类型 | 约束 | 说明 |
|--------|------|------|------|
| operator_code | VARCHAR(64) | NOT NULL, UNIQUE | 算子唯一编码 |
| object_code | VARCHAR(64) | NOT NULL | 数据对象编码 |
| data_format | VARCHAR(20) | NULLABLE | 数据格式（多选，逗号分隔） |
| generator | VARCHAR(20) | NULLABLE | 生成方式（dynamic/static） |

### 4.3 接口设计

#### 数据格式枚举常量

```java
public enum DataFormat {
    STATIC_MML("1", "静态MML"),
    DYNAMIC_MML("10", "动态MML"),
    HUA_TONG("12", "话统");

    private final String code;
    private final String name;
}
```

#### 生成方式枚举常量

```java
public enum Generator {
    DYNAMIC("dynamic", "动态"),
    STATIC("static", "静态");

    private final String code;
    private final String name;
}
```

#### API 更新

**创建算子** - `POST /api/v1/operators`
请求体新增字段：
```json
{
  "name": "算子名称",
  "description": "描述",
  "language": "JAVA",
  "version": "1.0.0",
  "operatorCode": "operator_name_001",
  "objectCode": "object_name_001",
  "dataFormat": "1,10",
  "generator": "dynamic"
}
```

**更新算子** - `PUT /api/v1/operators/{id}`
请求体同上

**查询算子列表** - `GET /api/v1/operators`
响应体新增字段

**查询算子详情** - `GET /api/v1/operators/{id}`
响应体新增字段

### 4.4 前端设计

#### 算子创建/编辑表单

**新增表单项：**

| 字段 | 中文名 | 控件类型 | 必填 | 校验规则 |
|------|--------|----------|------|----------|
| operatorCode | 算子唯一编码 | Input | 是 | 正则校验、唯一性校验 |
| objectCode | 数据对象编码 | Input | 是 | 正则校验 |
| dataFormat | 数据格式 | Checkbox.Group | 是 | 至少选择一项 |
| generator | 生成方式 | Select | 否 | 动态/静态 |

**正则表达式：**
```
^[a-zA-Z_][a-zA-Z0-9_]{0,63}$
```
- 首字符：字母或下划线
- 后续：字母、数字或下划线
- 总长度：1-64

#### 算子列表页面
在表格中新增 4 列：
- 算子唯一编码
- 数据对象编码
- 数据格式（显示为文本，如 "静态MML, 动态MML"）
- 生成方式

#### 算子详情页面
在基本信息区域新增 4 个字段的展示。

---

## 5. 实施计划

### 5.1 任务分解

| 序号 | 任务 | 模块 | 预估工作量 |
|------|------|------|-----------|
| 1 | 数据库表结构更新 | operator-core | 小 |
| 2 | 更新 Operator 实体类 | operator-core | 小 |
| 3 | 定义枚举常量 | operator-common | 小 |
| 4 | 添加参数校验注解 | operator-common | 小 |
| 5 | 更新 OperatorDto | operator-api | 中 |
| 6 | 更新 OperatorController | operator-api | 小 |
| 7 | 更新 OperatorService | operator-service | 中 |
| 8 | 实现唯一性校验 | operator-service | 中 |
| 9 | 更新前端类型定义 | operator-manager-web | 小 |
| 10 | 更新算子创建/编辑表单 | operator-manager-web | 中 |
| 11 | 更新算子列表页面 | operator-manager-web | 小 |
| 12 | 更新算子详情页面 | operator-manager-web | 小 |
| 13 | 单元测试 | 全部 | 中 |
| 14 | 集成测试 | 全部 | 中 |

### 5.2 依赖关系

```
任务1 (数据库) → 任务2 (实体)
任务3 (枚举) → 任务4 (校验)
任务2、任务4 → 任务5 (DTO)
任务5 → 任务6 (Controller)
任务2、任务5 → 任务7 (Service)
任务7 → 任务8 (唯一性校验)
任务3 → 任务9 (前端类型)
任务9 → 任务10、11、12 (前端页面)
任务2-8 → 任务13、14 (测试)
```

### 5.3 风险评估

| 风险 | 影响 | 概率 | 应对措施 |
|------|------|------|----------|
| Operator Code 格式校验过于严格 | 中 | 低 | 充分沟通确认规则，提供清晰的错误提示 |
| 唯一性校验性能问题 | 中 | 低 | 添加唯一索引，使用数据库约束 |
| Data Format 多选存储格式不统一 | 低 | 中 | 统一使用逗号分隔，前端/后端约定好格式 |
| 前后端字段名称不一致 | 低 | 中 | 统一使用驼峰命名，更新类型定义 |

---

## 6. 验收标准

### 6.1 功能验收
- [ ] 创建算子时，必填字段（operatorCode、objectCode）不能为空
- [ ] Operator Code 和 Object Code 符合格式要求
- [ ] Operator Code 全局唯一，重复时给出明确错误提示
- [ ] Data Format 支持多选，至少选择一项
- [ ] Generator 支持动态/静态单选，可为空
- [ ] 算子列表正确显示新增字段
- [ ] 算子详情正确显示新增字段
- [ ] 编辑算子时正确回显新增字段
- [ ] 所有新增字段的数据格式正确存储和展示

### 6.2 测试用例

| 用例编号 | 用例描述 | 预期结果 |
|---------|---------|---------|
| TC-001 | 创建算子，Operator Code 为空 | 提示必填 |
| TC-002 | 创建算子，Operator Code 以数字开头 | 提示格式错误 |
| TC-003 | 创建算子，Operator Code 包含非法字符 | 提示格式错误 |
| TC-004 | 创建算子，Operator Code 超过64字符 | 提示长度超限 |
| TC-005 | 创建算子，Operator Code 重复 | 提示唯一性错误 |
| TC-006 | 创建算子，Operator Code 格式正确 | 创建成功 |
| TC-007 | 创建算子，Object Code 格式正确 | 创建成功 |
| TC-008 | 创建算子，Data Format 未选择 | 提示至少选择一项 |
| TC-009 | 创建算子，Data Format 选择多项 | 创建成功，格式正确存储 |
| TC-010 | 创建算子，Generator 未选择 | 创建成功 |
| TC-011 | 创建算子，Generator 选择 dynamic | 创建成功 |
| TC-012 | 创建算子，所有字段正确填写 | 创建成功 |
| TC-013 | 编辑算子，修改 Operator Code 为重复值 | 提示唯一性错误 |
| TC-014 | 编辑算子，修改其他字段 | 修改成功 |
| TC-015 | 查询算子列表，验证新字段显示 | 正确显示 |

---

## 7. 附录

### 7.1 参考资料
- 现有 Operator 实体：`operator-core/src/main/java/com/operator/core/operator/domain/Operator.java`
- 现有 OperatorController：`operator-api/src/main/java/com/operator/api/controller/OperatorController.java`

### 7.2 变更记录

| 版本 | 日期 | 变更内容 | 修改人 |
|------|------|----------|--------|
| v1.0 | 2026-02-20 | 初始版本，需求分析和设计完成 | Claude |
