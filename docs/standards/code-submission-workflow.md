# 代码提交流程

**重要规则：修改代码后不要自动提交**

---

## 1. 验证要求

### 1.1 修改完成后必须验证

- 确保所有模块能够编译通过
- 确保应用能够正常启动
- 验证基本功能正常

### 1.2 验证步骤

#### 后端验证

**方式 1：逐模块编译验证**
```bash
cd operator-common
mvn clean install

cd ../operator-core
mvn clean install

cd ../operator-infrastructure
mvn clean install

cd ../operator-service
mvn clean install

cd ../operator-api
mvn clean install
```

**方式 2：整体编译验证**
```bash
# 从项目根目录
mvn clean install -DskipTests
```

**启动验证**
```bash
# 使用启动脚本
./start-backend-local.sh  # 本地调试模式
# 或
./start-backend.sh      # Docker 模式
```

#### 前端验证

**编译验证**
```bash
cd operator-manager-web
npm run build
```

**启动验证**
```bash
cd operator-manager-web
npm run dev
```

#### 功能验证

- 创建测试数据
- 调用 API 测试接口
- 前端页面操作测试
- 验证数据正确保存和读取

### 1.3 验证通过标准

**后端验证通过标准：**
- ✅ Maven 编译成功（BUILD SUCCESS）
- ✅ 应用启动成功（无异常日志）
- ✅ API 接口正常响应
- ✅ 数据正确保存到数据库

**前端验证通过标准：**
- ✅ npm run build 编译成功
- ✅ 无 TypeScript 错误
- ✅ 页面正常加载
- ✅ 功能操作无错误

---

## 2. 提交流程

### 2.1 禁止行为

❌ **严格禁止：**
- 修改代码后立即提交（未验证）
- 存在编译错误时提交
- 存在运行时错误时提交
- 未进行功能验证时提交

### 2.2 正确提交流程

**步骤 1：验证完成**
- 确保编译通过
- 确保服务正常启动
- 确保功能验证通过

**步骤 2：询问用户确认**
- 向用户报告验证结果
- 询问用户："代码已验证通过，是否提交？"
- 等待用户明确确认

**步骤 3：执行提交**
```bash
# 只有在用户确认后才执行
git add .
git commit -m "功能：实现 XXX"
git push
```

### 2.3 提交信息规范

必须使用中文编写提交信息，格式：
```bash
git commit -m "类型：简短描述"
```

**类型：**
- `功能` - 新功能实现
- `修复` - Bug 修复
- `重构` - 代码重构
- `文档` - 文档更新
- `测试` - 测试相关
- `性能` - 性能优化
- `安全` - 安全修复

---

## 3. 服务启动验证

### 3.1 启动服务

- 使用提供的启动脚本：`start-backend-local.sh` 或 `start-backend.sh`
- 不要直接执行 `mvn spring-boot:run`
- 脚本会自动处理进程清理、端口冲突等问题

### 3.2 启动后行为

**正确行为：**
- ✅ 启动服务后**不要停止**
- ✅ 等待用户自行验证
- ✅ 用户测试功能、查看日志
- ✅ 等待用户明确反馈

**禁止行为：**
- ❌ 启动后立即停止
- ❌ 未经用户同意就重启服务
- ❌ 频繁停止启动服务

### 3.3 停止服务时机

**可以停止的情况：**
- 用户明确要求停止
- 用户确认功能测试完成
- 需要重新编译启动（用户明确同意）

---

## 4. 常见问题

### Q1: 为什么要这么严格？

**A:** 确保代码质量，避免：
- 提交无法编译的代码
- 提交有明显 Bug 的代码
- 频繁回滚修复
- 破坏 CI/CD 流程

### Q2: 如果验证失败怎么办？

**A:**
1. 分析错误信息
2. 修复问题
3. 重新验证
4. 验证通过后才能考虑提交

### Q3: 调试代码怎么办？

**A:** 调试代码可以提交，但必须：
- 标记为"调试："调试：添加 XXX 日志"
- 确保不影响现有功能
- 尽快移除调试代码
- 移除前再次验证

---

## 5. 检查清单

提交前必须通过以下检查：

- [ ] 后端编译成功（mvn clean install）
- [ ] 前端编译成功（npm run build）
- [ ] 服务正常启动
- [ ] 基本功能验证通过
- [ ] 用户确认可以提交
- [ ] Git 提交信息符合规范
- [ ] 已删除不必要的调试代码（如果有的话）
