# 需求设计工作流程

> 创建日期：2026-02-21
> 版本：v1.0
> 目的：规范需求设计工作流程，确保需求设计质量和可追溯性

---

## 1. 工作流程概述

需求设计工作流程包含六个阶段，从准备到归档，确保需求设计质量和实施可行性。

```
开始
  │
  ├─> [阶段一：准备工作]
  │   ├─ AI 读取规约文档
  │   ├─ AI 了解现有代码结构
  │   └─ 明确需求目标
  │
  ├─> [阶段二：需求讨论]
  │   ├─ 业务需求描述
  │   ├─ 业务范围定义
  │   ├─ 业务流程梳理
  │   ├─ 核心业务规则
  │   └─ 技术约束和依赖
  │
  ├─> [阶段三：方案设计]
  │   ├─ AI 给出初步方案
  │   ├─ 数据模型设计
  │   ├─ API 接口设计
  │   ├─ 前端交互设计
  │   └─ 持续讨论细化 → 直到确认
  │
  ├─> [阶段四：方案确认]
  │   ├─ AI 整理完整文档
  │   ├─ 用户审阅
  │   ├─ 用户提出修改意见
  │   └─ 用户明确确认
  │
  ├─> [阶段五：归档]
  │   ├─ 保存到 docs/requirements/
  │   ├─ 更新 docs/requirements/README.md
  │   ├─ 更新项目 README.md（如需要）
  │   └─ 提交到 git
  │
  └─> [阶段六：实施规划]
      ├─ 制定分阶段实施计划（大颗粒需求）
      ├─ 记录风险分析
      ├─ 记录后续扩展方向
      └─ 等待开始实施
```

---

## 2. 阶段一：准备工作

### 2.1 AI 助手需要做的事

**必读文档：**
1. [开发规范](./development-conventions.md) - 理解开发规范和约束
2. [项目关键约束](./project-constraints.md) - 理解技术栈和功能范围约束
3. [代码提交流程](./code-submission-workflow.md) - 理解代码提交和验证要求

**了解现有代码：**
- 查看相关的实体类（Entity）
- 查看相关的 Repository
- 查看相关的 Service 和 Controller
- 参考类似功能的现有实现

### 2.2 用户需要做的事

- 明确本次需求的目标和大致范围
- 提供必要的上下文信息（如参考竞品、类似系统等）

---

## 3. 阶段二：需求讨论

### 3.1 讨论内容

1. **业务需求描述**
   - 清晰描述用户需要什么功能
   - 功能的使用场景和目标用户

2. **业务范围定义**
   - 本次要做什么（功能边界）
   - 本次**不**做什么（控制需求边界，防止需求蔓延）

3. **业务流程梳理**
   - 绘制业务流程图或文字描述
   - 明确每个步骤的输入和输出

4. **核心业务规则**
   - 约束条件
   - 校验规则
   - 异常处理规则

5. **技术约束和依赖**
   - 必须使用的技术栈
   - 需要兼容的现有格式
   - 依赖的其他功能或服务

### 3.2 输出

- 清晰的需求理解
- 明确的需求边界
- 核心业务规则清单

---

## 4. 阶段三：方案设计

### 4.1 AI 助手做的事

1. **给出初步实现方案**
   - 结合当前代码架构
   - 提出多个可选方案（如适用）

2. **数据模型设计**
   - 新增哪些实体表
   - 修改哪些现有表
   - 表之间的关系（一对一、一对多、多对多）
   - 关键字段定义

3. **API 接口设计**
   - 新增哪些接口
   - 接口的请求和响应格式
   - 接口路径和 HTTP 方法

4. **前端交互设计**
   - 需要哪些页面
   - 页面结构和交互流程
   - 关键 UI 组件设计

5. **持续讨论细化**
   - 根据用户反馈调整方案
   - 反复讨论，直到双方确认

### 4.2 输出

- 完整的技术方案
- 数据库变更方案（SQL 脚本）
- API 接口清单和定义
- 前端 UI 设计稿

---

## 5. 阶段四：方案确认

### 5.1 AI 助手做的事

1. **整理完整的方案设计文档**
   - 遵循 [需求设计文档模板](../requirements/需求设计文档模板.md)
   - 包含所有讨论的细节

2. **提交用户审阅**
   - 明确询问："方案文档已整理完成，请审阅"

### 5.2 用户需要做的事

1. **审阅方案文档**
   - 检查是否遗漏关键点
   - 检查是否符合预期

2. **提出修改意见**
   - 如有问题，提出修改意见
   - AI 根据意见调整文档

3. **明确确认**
   - 确认方案可以归档
   - 回复："确认"或"可以归档"

### 5.3 输出

- 确认的方案设计文档（待归档）

---

## 6. 阶段五：归档

### 6.1 AI 助手做的事

1. **保存文档到正确位置**
   - 路径：`docs/requirements/`
   - 命名规范：`YYYY-MM-DD-[需求名称]-需求设计.md`

2. **更新需求目录**
   - 更新 `docs/requirements/README.md` 的文档目录
   - 添加新文档的链接

3. **更新项目 README（如需要）**
   - 如项目级 README 有相关链接，一并更新

4. **提交到 git 仓库**
   - 遵循 [代码提交流程](./code-submission-workflow.md)
   - 使用中文提交信息
   - 等待用户确认后再 push

### 6.2 归档检查清单

- [ ] 文档命名规范正确
- [ ] 文档内容完整
- [ ] 已更新 docs/requirements/README.md
- [ ] 已更新项目 README.md（如需要）
- [ ] 已提交到 git
- [ ] 已推送到远程仓库

### 6.3 输出

- 归档的需求设计文档
- 更新的 README.md
- Git commit

---

## 7. 阶段六：实施规划

### 7.1 AI 助手做的事

1. **制定分阶段实施计划**（大颗粒需求）
   - 阶段一：数据库和后端基础
   - 阶段二：后端 Service 层
   - 阶段三：后端 API 层
   - 阶段四：前端开发
   - 阶段五：测试和优化
   - 每个阶段明确输出物和验收标准

2. **风险分析**（初步讨论和记录）
   - 技术风险：实现难度、技术选型风险
   - 业务风险：用户接受度、需求变更风险
   - 依赖风险：依赖的服务或资源
   - 风险应对措施

3. **后续扩展方向**（初步讨论和记录）
   - 未来可能的功能扩展
   - 可以优化和改进的方向
   - 供后续参考

### 7.2 输出

- 实施计划（可包含在需求文档中）
- 风险分析清单
- 后续扩展方向列表

---

## 8. 需求设计文档模板

参考文档：[需求设计文档模板](../requirements/需求设计文档模板.md)

建议包含以下章节：

1. 需求背景
2. 需求目标
3. 核心设计思路
4. 数据模型设计
5. 功能需求（详细）
6. API 接口设计
7. 前端 UI 设计
8. 数据库迁移脚本
9. 实施计划
10. 风险与注意事项
11. 后续扩展方向
12. 附录：相关文档

---

## 9. 关键原则

### 9.1 需求边界控制

- **明确不做的事情**：每次需求设计必须明确本次不做什么
- **控制需求蔓延**：讨论中如出现新需求，建议放到后续迭代
- **大颗粒需求分阶段**：复杂需求必须分阶段实施，减少实施风险

### 9.2 方案确认原则

- **明确确认才能归档**：AI 必须等待用户明确确认才能归档
- **确保对齐**：确认前必须确保双方理解一致
- **可以反复修改**：用户审阅后可提出修改意见，AI 调整后再确认

### 9.3 规约文档优先

- **必须先读规约**：每次需求设计前必须先读相关规约文档
- **遵循现有模式**：数据模型、API 设计要遵循现有模式
- **技术栈约束**：不能违反项目关键约束

### 9.4 归档规范

- **命名规范**：YYYY-MM-DD-[需求名称]-需求设计.md
- **更新目录**：每次归档后必须更新 docs/requirements/README.md
- **git 提交**：归档后必须提交到 git，遵循代码提交流程

---

## 10. 注意事项

### 10.1 会话开始时

- 如果用户提出新的需求设计，AI 应先：
  1. 读取本工作流程文档
  2. 读取相关规约文档
  3. 了解现有代码结构

### 10.2 讨论过程中

- 遇到模糊的需求，主动询问澄清
- 遇到技术难点，提前识别并讨论解决方案
- 遇到范围蔓延，提醒控制需求边界

### 10.3 方案确认前

- 使用 AskUserQuestion 工具确认方案
- 确保用户理解方案的所有关键点

### 10.4 归档前

- 检查文档是否完整
- 检查是否更新了 README.md
- 等待用户确认后再提交

---

## 11. 附录：相关文档

- [开发规范](./development-conventions.md)
- [项目关键约束](./project-constraints.md)
- [代码提交流程](./code-submission-workflow.md)
- [需求设计文档模板](../requirements/需求设计文档模板.md)
- [需求文档目录](../requirements/README.md)

---

**文档维护者**: Claude AI Assistant
**最后更新**: 2026-02-21
